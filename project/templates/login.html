{% extends "base.html" %}

{% block title %}OurTieba{% endblock %}
{% block head %}
    {{ super() }}
    <style>

        .form-signin {
            width: 100%;
            max-width: 330px;
            padding: 15px;
            margin: 0 auto;
        }

        .form-signin .checkbox {
            font-weight: 400;
        }

        .form-signin .form-control {
            position: relative;
            box-sizing: border-box;
            height: auto;
            padding: 10px;
            font-size: 16px;
        }

        .form-signin .form-control:focus {
            z-index: 2;
        }

        .form-signin input[type="email"] {
            margin-bottom: -1px;
            border-bottom-right-radius: 0;
            border-bottom-left-radius: 0;
        }

        .form-signin input[type="password"] {
            margin-bottom: 10px;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }

    </style>
{% endblock %}
{% block page_content %}

    <h1>Login</h1>
    <hr>
    <iframe name="dummy" id="dummy" style="display: none;"></iframe>

    <form class="form-signin" action="{{ url_for('api.login_auth') }}" method="post" target="dummy">
        <img class="mb-4" src="{{ url_for("static", filename='ico/favicon.ico') }}" alt="" width="72"
             height="72">
        <h1 class="h3 mb-3 font-weight-normal">Please sign in</h1>
        <label for="uname" class="sr-only">Username</label>
        <input type="text" id="uname" class="form-control" placeholder="Username" required autofocus>
        <label for="password" class="sr-only">Password</label>
        <input type="password" id="password" class="form-control" placeholder="Password" required>
        <button class="btn btn-lg btn-primary btn-block" id="btn_submit" type="submit">Sign in</button>
    </form>

    <p id="username-err"></p>
    <p class="sr-only">ao</p>

{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        $(document).ready(function () {
            $("#btn_submit").click(function () {
                let uname = $("#uname").val().trim();
                let password = $("#password").val().trim();

                if (uname !== "" && password !== "") {
                    $.ajax({
                        url: '/api/auth/login',
                        type: 'post',
                        dataType: 'json',
                        data: {uname: uname, password: password},
                        success: function (response) {
                            let msg = "";
                            if (response.status) {
                                window.location = "/";
                            } else {
                                msg = "Invalid username and password!";
                            }
                            $("#username-err").html(msg);
                        }
                    });
                }
            });
        });
    </script>
{% endblock %}
