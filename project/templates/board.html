{% extends "base.html" %}

{% block title %} Boards {% endblock %}

{% block head %}
    {{ super() }}
    <script>
        function setParam(name, value) {
            const l = window.location;

            /* build params */
            const params = {};
            const x = /(?:\??)([^=&?]+)=?([^&?]*)/g;
            const s = l.search;
            for (let r = x.exec(s); r; r = x.exec(s)) {
                r[1] = decodeURIComponent(r[1]);
                if (!r[2]) r[2] = '%%';
                params[r[1]] = r[2];
            }

            /* set param */
            params[name] = encodeURIComponent(value);

            /* build search */
            let search = [];
            for (let i in params) {
                let p = encodeURIComponent(i);
                const v = params[i];
                if (v !== '%%') p += '=' + v;
                search.push(p);
            }
            search = search.join('&');

            /* execute search */
            l.search = search;
        }
    </script>

{% endblock %}
{% block page_content %}
    <p style="font-size:50px">{{ data['board_info']['name'] }}</p>
    <div style="text-align: right">
        Sort by:
        <a href="javascript:setParam('order', 'latest_comment')">latest comment</a>
        <a href="javascript:setParam('order', 'newest')">newest</a>
        <a href="javascript:setParam('order', 'like_count')">likes</a>
    </div>
    <hr>
    {% for post in data['posts'] %}
        <article class="post">
            <header>
                <div>
                    <h3><a href="/post/{{ post['Pid'] }}" class="text-decoration-none">{{ post['title'] }}</a></h3>

                    <div class="blockquote-footer">{{ moment(post['publish_time']).fromNow() }}</div>


                    <i class="bi bi-hand-thumbs-up"></i>{{ post['like_count'] }}
                    <i class="bi bi-hand-thumbs-down"></i>{{ post['dislike_count'] }}

                </div>
            </header>
            <p class="body">{{ post['summary'] }}</p>
        </article>
        {% if not loop.last %}
            <hr>
        {% endif %}
    {% endfor %}

    {# Pagination #}
    <nav>
        <ul class="pagination justify-content-center">
            <li class="page-item {% if data['page'] == 1 %}disabled{% endif %}">
                <a class="page-link" href="javascript:setParam('page',{{ data['page'] - 1 }})"
                   tabindex="-1">Previous</a>
            </li>

            {% for i in range(1, 1 + data['num_page']) %}
                <li class="page-item{% if i == data['page'] %} active {% endif %}">
                    <a class="page-link" href="javascript:setParam('page',{{ i }})">{{ i }}</a>
                </li>
            {% endfor %}

            <li class="page-item {% if data['page'] == data['num_page'] %}disabled{% endif %}">
                <a class="page-link" href="javascript:setParam('page',{{ data['page'] + 1 }})">Next</a>
            </li>
        </ul>
    </nav>


{% endblock %}
