{% extends "base.html" %}

{% block title %} Profile {% endblock %}
{% block page_content %}
    <div class="display-6">{{ data['nickname'] }}</div>
    {% if data['isCurrent'] %}
        <div class="float-lg-end">
            <button class="btn btn-warning"><a class="text-decoration-none text-body" href="">Edit Profile</a></button>
        </div>
    {% endif %}
    <br>
    <hr>

    {% if data['banned'] == 1 %}
        <div class="alert-danger">User banned until: {{ moment(data['banDuration']).fromNow() }}</div>
    {% endif %}
    {% if data['isCurrent'] %}
        <h4>Change your Avatar</h4>
        <img id="avatar-upload" style=" cursor: pointer" src="{{ '/cdn/'+ session.user_info["avatar"] }}" width="100"
             height="100"
             class="rounded-circle" data-toggle="tooltip" title="Change your avatar">
        <input id="uploadImg" type="file" accept="image/*" onchange="uploadImg(this.files[0]);" style="display: none">
    {% else %}
        <img id="avatar-upload" src="{{ '/cdn/'+ data["avatar"] }}" width="100"
             height="100" class="rounded-circle">
    {% endif %}
    <hr>
    <div class="h3">
        Date of Birth:
        {{ 'Not Set' if data['dateOfBirth'] is none else moment(data['dateOfBirth']).format('YYYY/M/D') }}
    </div>
    <div class="h3">Gender: {{ 'Not Set' if data['gender'] is none else data['gender'] }}</div>
    <div class="h3">Email Address: {{ 'Not Set' if data['email'] is none else data['email'] }}</div>
    <div class="h3">Phone Number: {{ 'Not Set' if data['phoneNumber'] is none else data['phoneNumber'] }}</div>
    <div class="h3">Address: {{ 'Not Set' if data['address'] is none else data['address'] }}</div>
    <hr>


    <script>
        $("#avatar-upload").click(function () {
            $("#uploadImg").trigger('click');
        });

        function uploadImg(file) {
            if (file.type.substr(0, 5) !== "image") {
                alert("Invalid File Type!");
                return;
            }
            if (file.size > (3 * 1024 * 1024)) {
                alert("Image Too Large!");
                return;
            }
            const formData = new FormData();
            formData.append("file", file);
            $.ajax({
                method: "post",
                url: "/api/upload",
                data: formData,
                processData: false,
                contentType: false,
                success: (data) => {
                    if (data.hasOwnProperty("status")) {
                        alert("Successfully uploaded image!");
                        location.reload();
                    } else {
                        alert(data.error.msg);
                    }
                }
            })
        }
    </script>
{% endblock %}
